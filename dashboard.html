<!DOCTYPE html>
<html>
<head>
<title>Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body{
font-family:Arial;
text-align:center;
background:linear-gradient(135deg,#6a11cb,#2575fc,#00c6ff);
color:white;
padding:40px;
}
.box{
background:rgba(255,255,255,0.15);
padding:30px;
border-radius:20px;
display:inline-block;
width:320px;
}
input{
padding:10px;
margin:6px;
width:90%;
border:none;
border-radius:10px;
}
button{
padding:10px 20px;
border:none;
border-radius:20px;
background:white;
color:#2575fc;
font-weight:bold;
margin-top:10px;
cursor:pointer;
}
a{
display:block;
background:white;
color:#2575fc;
padding:12px;
margin:10px 0;
border-radius:12px;
text-decoration:none;
font-weight:bold;
}
</style>
</head>
<body>
<h1>Dashboard</h1>
<div class="box">
<h2 id="welcome">Loading...</h2>
<p>Your public link:</p>
<h3 id="publicLink"></h3>
<hr>
<input id="title" placeholder="Instagram / YouTube">
<input id="url" placeholder="https://">
<button onclick="addLink()">Add Link</button>
<div id="links"></div>
<br>
<button onclick="logout()">Logout</button>
</div>
<script>
const { createClient } = supabase;

const supabaseClient=createClient(
"https://pibrvhziqkaitaacbegy.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpYnJ2aHppcWthaXRhYWNiZWd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0Mzc3MDQsImV4cCI6MjA4NzAxMzcwNH0.gBi73cyS6exLNfm1iz6IwAzWFXXxFAjgjlnbuHx7HMw"
);

let userId=null;

async function load(){
const {data:{user}}=await supabaseClient.auth.getUser();

if(!user){
location.href="/";
return;
}

userId=user.id;

// get profile
const {data:profile}=await supabaseClient
.from("profiles")
.select("*")
.eq("id",user.id)
.single();

if(!profile){
document.getElementById("welcome").innerText="Profile not found";
return;
}

document.getElementById("welcome").innerText="Hello "+profile.username;

document.getElementById("publicLink").innerText=
"linkarsha.vercel.app/"+profile.username;

loadLinks();
}

async function addLink(){
const title=document.getElementById("title").value;
const url=document.getElementById("url").value;

if(!title||!url) return;

await supabaseClient.from("links").insert([
{user_id:userId,title:title,url:url}
]);

loadLinks();
}

async function loadLinks(){
const {data}=await supabaseClient
.from("links")
.select("*")
.eq("user_id",userId);

let html="";
data.forEach(l=>{
html+=`<a href="${l.url}" target="_blank">${l.title}</a>`;
});
document.getElementById("links").innerHTML=html;
}

async function logout(){
await supabaseClient.auth.signOut();
location.href="/";
}

load();
</script>
</body>
</html>
