<!DOCTYPE html>
<html>
<head>
  <title>Linkarsha Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body{
      font-family: Arial;
      background: linear-gradient(135deg,#6a11cb,#2575fc,#00c6ff);
      color:white;
      text-align:center;
      padding:40px;
    }

    .box{
      background: rgba(255,255,255,0.15);
      padding:30px;
      border-radius:20px;
      display:inline-block;
      margin-top:40px;
    }

    button{
      padding:10px 20px;
      border:none;
      border-radius:20px;
      background:white;
      color:#2575fc;
      font-weight:bold;
      cursor:pointer;
      margin-top:20px;
    }
  </style>
</head>

<body>

<h1>Welcome to Linkarsha</h1>

<div class="box">
  <h2 id="welcome"></h2>
  <p>Your public link:</p>
  <h3 id="publicLink"></h3>

  <button onclick="logout()">Logout</button>
</div>

<script>
  const { createClient } = supabase;
  const supabaseClient = createClient(
    "https://pibrvhziqkaitaacbegy.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpYnJ2aHppcWthaXRhYWNiZWd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0Mzc3MDQsImV4cCI6MjA4NzAxMzcwNH0.gBi73cyS6exLNfm1iz6IwAzWFXXxFAjgjlnbuHx7HMw"
  );

  async function loadUser(){
    const { data: { user } } = await supabaseClient.auth.getUser();

    if(!user){
      window.location.href = "/";
      return;
    }

    const { data, error } = await supabaseClient
      .from("profiles")
      .select("*")
      .eq("id", user.id)
      .single();

    if(data){
      document.getElementById("welcome").innerText =
        "Hello, " + data.username;

      document.getElementById("publicLink").innerText =
        "https://linkarsha.netlify.app/" + data.username;
    }
  }

  async function logout(){
    await supabaseClient.auth.signOut();
    window.location.href = "/";
  }

  loadUser();
</script>

</body>
</html>
