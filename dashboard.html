<!DOCTYPE html>
<html>
<head>
<title>Linkarsha Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#f6f7fb;
}

.header{
padding:22px 40px;
font-weight:800;
font-size:22px;
background:white;
box-shadow:0 2px 10px rgba(0,0,0,0.05);
}

.container{
display:flex;
gap:40px;
padding:40px;
flex-wrap:wrap;
}

.left,.right{
background:white;
border-radius:22px;
padding:28px;
box-shadow:0 10px 30px rgba(0,0,0,0.06);
}

.left{width:340px;}
.right{flex:1;min-width:320px;}

.previewCard{
background:linear-gradient(135deg,#eef2ff,#f5f3ff);
border-radius:25px;
padding:28px;
text-align:center;
}

.avatar{
width:92px;
height:92px;
border-radius:50%;
background:#6366f1;
color:white;
display:flex;
align-items:center;
justify-content:center;
font-size:34px;
margin:auto;
margin-bottom:12px;
}

.linkbtn{
display:block;
background:white;
padding:14px;
margin:10px 0;
border-radius:16px;
text-decoration:none;
color:#111;
font-weight:600;
box-shadow:0 8px 18px rgba(0,0,0,0.06);
}

input{
width:100%;
padding:14px;
margin:9px 0;
border-radius:14px;
border:1px solid #eee;
font-size:14px;
}

button{
padding:14px 18px;
border:none;
border-radius:16px;
background:linear-gradient(135deg,#6366f1,#7c3aed);
color:white;
font-weight:700;
cursor:pointer;
margin-top:10px;
}

.sectionTitle{
font-weight:700;
margin-top:8px;
margin-bottom:12px;
font-size:18px;
}

.stat{
background:#f1f5ff;
padding:12px;
border-radius:12px;
margin:6px 0;
font-weight:600;
}
</style>
</head>

<body>
<div class="header">Linkarsha Creator Studio ðŸ’Ž</div>

<div class="container">

<div class="left">
<div class="previewCard">
<div class="avatar" id="avatar">U</div>
<div id="previewUsername">@username</div>
<div id="previewBio" style="color:#666;font-size:14px;margin:8px 0"></div>
<div id="previewLinks"></div>
</div>
</div>

<div class="right">

<div class="sectionTitle">Bio</div>
<input id="bioInput" placeholder="Write bio">
<button onclick="saveBio()">Save Bio</button>

<hr style="margin:25px 0">

<div class="sectionTitle">Add Link</div>
<input id="title" placeholder="Title">
<input id="url" placeholder="https://">

<label>
<input type="checkbox" id="paidToggle"> Paid link ðŸ’°
</label>

<input id="price" placeholder="Price â‚¹" style="display:none">
<input id="lockedMsg" placeholder="Unlock message" style="display:none">

<button onclick="addLink()">Add Link</button>

<div id="linksList"></div>

<hr style="margin:25px 0">

<div class="sectionTitle">Analytics</div>
<div class="stat" id="viewCount">Profile Views: 0</div>
<div class="stat" id="totalLinks">Total Links: 0</div>

</div>
</div>

<script>
const { createClient } = supabase;

const supabaseClient=createClient(
"https://pibrvhziqkaitaacbegy.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpYnJ2aHppcWthaXRhYWNiZWd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0Mzc3MDQsImV4cCI6MjA4NzAxMzcwNH0.gBi73cyS6exLNfm1iz6IwAzWFXXxFAjgjlnbuHx7HMw"
);

let userId=null;

document.getElementById("paidToggle").addEventListener("change",()=>{
let on=document.getElementById("paidToggle").checked;
document.getElementById("price").style.display=on?"block":"none";
document.getElementById("lockedMsg").style.display=on?"block":"none";
});

async function load(){

const {data:{user}}=await supabaseClient.auth.getUser();
if(!user){location.href="/";return;}

userId=user.id;

const {data:profile}=await supabaseClient.from("profiles").select("*").eq("id",userId).single();

document.getElementById("previewUsername").innerText="@"+profile.username;
document.getElementById("avatar").innerText=profile.username.charAt(0).toUpperCase();

if(profile.bio){
document.getElementById("previewBio").innerText=profile.bio;
document.getElementById("bioInput").value=profile.bio;
}

document.getElementById("viewCount").innerText="Profile Views: "+(profile.views||0);

loadLinks();
}

async function saveBio(){
let bio=document.getElementById("bioInput").value;
await supabaseClient.from("profiles").update({bio}).eq("id",userId);
document.getElementById("previewBio").innerText=bio;
}

async function addLink(){

let title=document.getElementById("title").value;
let url=document.getElementById("url").value;
let paid=document.getElementById("paidToggle").checked;
let price=document.getElementById("price").value||0;
let msg=document.getElementById("lockedMsg").value||"Unlock";

await supabaseClient.from("links").insert([
{user_id:userId,title,url,is_paid:paid,price,locked_message:msg}
]);

document.getElementById("title").value="";
document.getElementById("url").value="";
loadLinks();
}

async function loadLinks(){

const {data}=await supabaseClient.from("links").select("*").eq("user_id",userId);

let html="";
let preview="";

data.forEach(l=>{

html+=`<div>${l.title}</div>`;

if(l.is_paid){
preview+=`<div class="linkbtn">ðŸ”’ ${l.title} â‚¹${l.price}</div>`;
}else{
preview+=`<a class="linkbtn" href="${l.url}" target="_blank">${l.title}</a>`;
}
});

document.getElementById("linksList").innerHTML=html;
document.getElementById("previewLinks").innerHTML=preview;
document.getElementById("totalLinks").innerText="Total Links: "+data.length;
}

load();
</script>
</body>
</html>
