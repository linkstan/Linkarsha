<!DOCTYPE html>
<html>
<head>
<title>Linkarsha Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#f6f7fb;
}

.header{
padding:20px 40px;
font-weight:700;
font-size:20px;
background:white;
box-shadow:0 2px 10px rgba(0,0,0,0.05);
}

.container{
display:flex;
gap:40px;
padding:40px;
flex-wrap:wrap;
}

.left,.right{
background:white;
border-radius:20px;
padding:25px;
box-shadow:0 10px 30px rgba(0,0,0,0.06);
}

.left{width:340px;}
.right{flex:1;min-width:300px;}

.previewCard{
border-radius:25px;
padding:25px;
text-align:center;
}

.avatar{
width:70px;
height:70px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:26px;
margin:auto;
margin-bottom:10px;
background-size:cover;
background-position:center;
}

.linkbtn{
display:block;
padding:12px;
margin:8px 0;
border-radius:12px;
text-decoration:none;
font-weight:600;
}

.statBox{
background:linear-gradient(135deg,#6366f1,#4f46e5);
color:white;
padding:16px;
border-radius:14px;
margin-bottom:10px;
font-weight:600;
}

input,select{
width:100%;
padding:12px;
margin:8px 0;
border-radius:10px;
border:1px solid #eee;
}

button{
padding:12px 18px;
border:none;
border-radius:12px;
background:#6366f1;
color:white;
font-weight:600;
cursor:pointer;
margin-top:8px;
}

.sectionTitle{
font-weight:700;
margin-top:15px;
margin-bottom:10px;
}
</style>
</head>

<body>

<div class="header">Linkarsha Studio</div>

<div class="container">

<div class="left">
<div class="previewCard" id="previewCard">
<div class="avatar" id="avatar">U</div>
<div id="previewUsername">@username</div>
<div id="previewBio" style="margin:8px 0"></div>
<div id="previewLinks"></div>
</div>
</div>

<div class="right">

<div class="sectionTitle">Analytics</div>
<div class="statBox" id="viewStat">üëÅ 0 Profile Views</div>

<hr style="margin:25px 0">

<div class="sectionTitle">Design Customization</div>

<label>Background Color</label>
<input type="color" id="bgColor">

<label>Text Color</label>
<input type="color" id="textColor">

<label>Button Color</label>
<input type="color" id="buttonColor">

<label>Font Style</label>
<select id="fontSelect">
<option value="default">Default</option>
<option value="serif">Serif</option>
<option value="monospace">Monospace</option>
<option value="modern">Modern</option>
</select>

<button onclick="saveDesign()">Save Design</button>

</div>
</div>

<script>
const { createClient } = supabase;

const supabaseClient=createClient(
"https://pibrvhziqkaitaacbegy.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpYnJ2aHppcWthaXRhYWNiZWd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0Mzc3MDQsImV4cCI6MjA4NzAxMzcwNH0.gBi73cyS6exLNfm1iz6IwAzWFXXxFAjgjlnbuHx7HMw"
);

let userId=null;

async function load(){

const {data:{user}}=await supabaseClient.auth.getUser();
if(!user){ location.href="/"; return; }
userId=user.id;

const {data:profile}=await supabaseClient
.from("profiles")
.select("*")
.eq("id",user.id)
.single();

document.getElementById("previewUsername").innerText="@"+profile.username;
document.getElementById("previewBio").innerText=profile.bio||"";

document.getElementById("viewStat").innerText="üëÅ "+(profile.views||0)+" Profile Views";

document.getElementById("bgColor").value=profile.bg_color||"#ffffff";
document.getElementById("textColor").value=profile.text_color||"#111111";
document.getElementById("buttonColor").value=profile.button_color||"#ffffff";
document.getElementById("fontSelect").value=profile.font||"default";

applyDesign(profile);

loadLinks(profile);
}

function applyDesign(profile){

const card=document.getElementById("previewCard");
card.style.background=profile.bg_color;
card.style.color=profile.text_color;

const buttons=document.querySelectorAll(".linkbtn");
buttons.forEach(btn=>{
btn.style.background=profile.button_color;
btn.style.color=profile.text_color;
});

if(profile.font==="serif"){
card.style.fontFamily="serif";
}
else if(profile.font==="monospace"){
card.style.fontFamily="monospace";
}
else if(profile.font==="modern"){
card.style.fontFamily="Inter, sans-serif";
}
else{
card.style.fontFamily="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto";
}
}

async function saveDesign(){

const bg=document.getElementById("bgColor").value;
const text=document.getElementById("textColor").value;
const btn=document.getElementById("buttonColor").value;
const font=document.getElementById("fontSelect").value;

await supabaseClient
.from("profiles")
.update({
bg_color:bg,
text_color:text,
button_color:btn,
font:font
})
.eq("id",userId);

load();
}

async function loadLinks(profile){

const {data}=await supabaseClient
.from("links")
.select("*")
.eq("user_id",userId);

let html="";
data.forEach(l=>{
html+=`<a class="linkbtn" href="#">${l.title}</a>`;
});

document.getElementById("previewLinks").innerHTML=html;
}

load();
</script>

</body>
</html>
