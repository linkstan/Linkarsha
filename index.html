<!DOCTYPE html>
<html>
<head>
<title>Linkarsha</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;}

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:linear-gradient(135deg,#eef2ff,#f5f3ff,#fafafa);
min-height:100vh;
display:flex;
align-items:center;
justify-content:center;
}

.card{
width:380px;
max-width:92%;
background:rgba(255,255,255,0.85);
backdrop-filter:blur(20px);
border-radius:28px;
padding:40px 25px;
text-align:center;
box-shadow:0 30px 80px rgba(0,0,0,0.12);
}

.logo{
font-size:34px;
font-weight:800;
margin-bottom:6px;
}

.tag{
color:#666;
margin-bottom:25px;
}

input{
width:100%;
padding:15px;
margin:10px 0;
border-radius:14px;
border:1px solid #eee;
font-size:15px;
outline:none;
}

button{
width:100%;
padding:15px;
margin-top:10px;
border:none;
border-radius:14px;
background:#6366f1;
color:white;
font-weight:600;
font-size:15px;
cursor:pointer;
}

hr{
margin:25px 0;
border:none;
border-top:1px solid #eee;
}

.result{
text-align:left;
padding:14px;
border-radius:14px;
background:#f6f6f6;
margin:8px 0;
cursor:pointer;
font-weight:600;
}

.result:hover{
background:#ececff;
}
</style>

</head>

<body>

<div class="box">

<h1>Linkarsha</h1>
<p>Create. Share. Discover creators.</p>

<!-- SEARCH -->
<input id="searchInput" placeholder="Search creators..." onkeyup="searchUser()">
<div id="results"></div>

<hr style="margin:25px 0">

<h3>Create account</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<input id="username" placeholder="Username">
<button onclick="signup()">Create Account</button>

<p id="msg"></p>

<hr style="margin:20px 0">
<button onclick="login()">Login</button>

</div>

<script>
const { createClient } = supabase;

const supabaseClient=createClient(
"https://pibrvhziqkaitaacbegy.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpYnJ2aHppcWthaXRhYWNiZWd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0Mzc3MDQsImV4cCI6MjA4NzAxMzcwNH0.gBi73cyS6exLNfm1iz6IwAzWFXXxFAjgjlnbuHx7HMw"
);

// SEARCH FUNCTION
async function searchUser(){
const q=document.getElementById("searchInput").value.toLowerCase();

if(q.length<1){
document.getElementById("results").innerHTML="";
return;
}

const {data}=await supabaseClient
.from("profiles")
.select("username,verified")
.ilike("username","%"+q+"%")
.limit(8);

let html="";
data.forEach(u=>{
html+=`
<div class="result" onclick="openProfile('${u.username}')">
@${u.username} ${u.verified?'âœ”':''}
</div>`;
});

document.getElementById("results").innerHTML=html;
}

function openProfile(username){
window.location.href="/"+username;
}

// SIGNUP
async function signup(){
const email=emailInput.value;
const password=passwordInput.value;
const username=usernameInput.value.toLowerCase();

if(!email||!password||!username){
msg.innerText="Fill all fields";
return;
}

const {data,error}=await supabaseClient.auth.signUp({email,password});
if(error){msg.innerText=error.message;return;}

await supabaseClient.from("profiles").insert([
{id:data.user.id,username:username}
]);

msg.innerText="Account created. Login now.";
}

// LOGIN
async function login(){
const {error}=await supabaseClient.auth.signInWithPassword({
email:emailInput.value,
password:passwordInput.value
});
if(error){msg.innerText=error.message;return;}
window.location.href="/dashboard";
}

// auto login
async function check(){
const {data:{user}}=await supabaseClient.auth.getUser();
if(user) window.location.href="/dashboard";
}
check();
</script>

</body>
</html>
