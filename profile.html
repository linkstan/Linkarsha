<!DOCTYPE html>
<html>
<head>
<title>Linkarsha</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:linear-gradient(135deg,#eef2ff,#f5f3ff);
min-height:100vh;
display:flex;
align-items:center;
justify-content:center;
}

.card{
width:360px;
max-width:92%;
background:white;
border-radius:30px;
padding:40px 25px;
text-align:center;
box-shadow:0 30px 80px rgba(0,0,0,0.12);
}

.avatar{
width:95px;
height:95px;
border-radius:50%;
margin:auto;
margin-bottom:14px;
background:linear-gradient(135deg,#7c3aed,#6366f1);
display:flex;
align-items:center;
justify-content:center;
color:white;
font-size:36px;
font-weight:700;
}

.username{
font-size:22px;
font-weight:700;
}

.bio{
color:#666;
margin:10px 0 20px;
font-size:14px;
}

.link{
display:block;
padding:15px;
margin:12px 0;
border-radius:16px;
text-decoration:none;
font-weight:600;
color:#111;
background:#f8f9ff;
}

</style>
</head>

<body>
<div class="card">
<div class="avatar" id="avatar">U</div>
<div class="username" id="username">@user</div>
<div class="bio" id="bio"></div>
<div id="links"></div>
</div>

<script>
const { createClient } = supabase;

const supabaseClient=createClient(
"https://pibrvhziqkaitaacbegy.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpYnJ2aHppcWthaXRhYWNiZWd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0Mzc3MDQsImV4cCI6MjA4NzAxMzcwNH0.gBi73cyS6exLNfm1iz6IwAzWFXXxFAjgjlnbuHx7HMw"
);

let username=window.location.pathname.replace("/","").toLowerCase();

async function load(){

const {data:profile}=await supabaseClient.from("profiles").select("*").eq("username",username).single();

if(!profile){
document.body.innerHTML="<h2>User not found</h2>";
return;
}

document.getElementById("username").innerText="@"+profile.username;
document.getElementById("bio").innerText=profile.bio||"";

document.getElementById("avatar").innerText=profile.username.charAt(0).toUpperCase();

// add view
await supabaseClient.from("profiles").update({views:(profile.views||0)+1}).eq("id",profile.id);

const {data:links}=await supabaseClient.from("links").select("*").eq("user_id",profile.id).order("position",{ascending:true});

let html="";
links.forEach(l=>{
if(l.is_paid){
html+=`<div class="link">ðŸ”’ ${l.title} â‚¹${l.price}</div>`;
}else{
html+=`<a class="link" href="${l.url}" target="_blank">${l.title}</a>`;
}
});

document.getElementById("links").innerHTML=html;
}

load();
</script>
</body>
</html>
