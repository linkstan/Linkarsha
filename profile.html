<!DOCTYPE html>
<html>
<head>
<title>Linkarsha</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:linear-gradient(135deg,#eef2ff,#f5f3ff,#fafafa);
min-height:100vh;
display:flex;
align-items:center;
justify-content:center;
}

.card{
width:380px;
max-width:92%;
background:rgba(255,255,255,0.75);
backdrop-filter:blur(20px);
border-radius:30px;
padding:40px 25px;
text-align:center;
box-shadow:0 40px 120px rgba(0,0,0,0.15);
}

.avatar{
width:100px;
height:100px;
border-radius:50%;
margin:auto;
margin-bottom:15px;
background:linear-gradient(135deg,#7c3aed,#6366f1);
display:flex;
align-items:center;
justify-content:center;
color:white;
font-size:38px;
font-weight:700;
background-size:cover;
background-position:center;
}

.username{
font-size:24px;
font-weight:700;
}

.bio{
color:#666;
margin-top:6px;
margin-bottom:18px;
font-size:14px;
}

.link{
display:block;
padding:16px;
margin:12px 0;
border-radius:16px;
text-decoration:none;
font-weight:600;
color:#111;
background:white;
box-shadow:0 15px 30px rgba(0,0,0,0.1);
transition:0.25s;
}

.link:hover{
transform:scale(1.04);
box-shadow:0 20px 40px rgba(0,0,0,0.18);
}

.footer{
margin-top:22px;
font-size:12px;
color:#aaa;
}
</style>
</head>

<body>
<div class="card">
<div class="avatar" id="avatar">U</div>
<div class="username" id="username">@user</div>
<div class="bio" id="bio">Creator</div>
<div id="links"></div>
<div class="footer">Powered by Linkarsha</div>
</div>

<script>
const { createClient } = supabase;

const supabaseClient=createClient(
"https://pibrvhziqkaitaacbegy.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpYnJ2aHppcWthaXRhYWNiZWd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0Mzc3MDQsImV4cCI6MjA4NzAxMzcwNH0.gBi73cyS6exLNfm1iz6IwAzWFXXxFAjgjlnbuHx7HMw"
);

// ‚≠ê IMPORTANT: always lowercase URL username
let username=window.location.pathname.replace("/","").toLowerCase();

async function load(){

if(!username){
document.body.innerHTML="<h2>User not found</h2>";
return;
}

// get profile
const {data:profile,error}=await supabaseClient
.from("profiles")
.select("*")
.ilike("username",username)
.single();

if(error || !profile){
document.body.innerHTML="<h2 style='font-family:sans-serif'>User not found</h2>";
return;
}

// show username
document.getElementById("username").innerText="@"+profile.username;

// bio
if(profile.bio){
document.getElementById("bio").innerText=profile.bio;
}

// avatar
if(profile.avatar_url){
document.getElementById("avatar").style.background="url('"+profile.avatar_url+"')";
document.getElementById("avatar").innerText="";
}else{
document.getElementById("avatar").innerText=profile.username.charAt(0).toUpperCase();
}

// links
const {data:links}=await supabaseClient
.from("links")
.select("*")
.eq("user_id",profile.id);

let html="";
if(links){
links.forEach(l=>{
html+=`<a class="link" href="${l.url}" target="_blank">${l.title}</a>`;
});
}

document.getElementById("links").innerHTML=html;
}

load();
</script>

</body>
</html>
