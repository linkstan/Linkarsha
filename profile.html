<!DOCTYPE html>
<html>
<head>
  <title>Linkarsha</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body{
      font-family: Arial;
      background: linear-gradient(135deg,#6a11cb,#2575fc,#00c6ff);
      color:white;
      text-align:center;
      padding:40px;
    }

    .box{
      background: rgba(255,255,255,0.15);
      padding:30px;
      border-radius:20px;
      display:inline-block;
      margin-top:40px;
      width:320px;
    }

    a{
      display:block;
      background:white;
      color:#2575fc;
      padding:12px;
      margin:10px 0;
      border-radius:12px;
      text-decoration:none;
      font-weight:bold;
    }
  </style>
</head>

<body>

<h1 id="username">Loading...</h1>

<div class="box">
  <div id="bio"></div>
  <div id="links"></div>
</div>

<script>
const { createClient } = supabase;
const supabaseClient = createClient(
  "https://pibrvhziqkaitaacbegy.supabase.co",
  "PASTE_ANON_KEY"
);

async function loadProfile(){

  const path = window.location.pathname;

  // if homepage â†’ go to index
  if(path === "/" || path === ""){
    window.location.href = "/";
    return;
  }

  const username = path.split("/").pop();

  if(!username){
    document.getElementById("username").innerText = "User not found";
    return;
  }

  const { data: profile, error } = await supabaseClient
    .from("profiles")
    .select("*")
    .ilike("username", username)
    .single();

  if(error || !profile){
    document.getElementById("username").innerText = "User not found";
    return;
  }

  document.getElementById("username").innerText = profile.username;

  if(profile.bio){
    document.getElementById("bio").innerHTML =
      "<p style='margin-bottom:20px'>" + profile.bio + "</p>";
  }

  const { data: links } = await supabaseClient
    .from("links")
    .select("*")
    .eq("user_id", profile.id);

  let html="";

  if(links && links.length>0){
    links.forEach(link=>{
      html += `<a href="${link.url}" target="_blank">${link.title}</a>`;
    });
  }else{
    html = "<p>No links added yet</p>";
  }

  document.getElementById("links").innerHTML = html;
}

loadProfile();
</script>

</body>
</html>
